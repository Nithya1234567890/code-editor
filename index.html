<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Compiler</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/clike/clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>

<body style="margin: 0; padding: 0; width: 99vw; height: 90vh;">
    <div class="row m-3" style="height: 100%;">
        <div class="col">
            <div class="d-flex justify-content-between mb-2 bg-dark rounded p-2">
                <div class="col-12 w-25">
                    <label class="visually-hidden" for="autoSizingSelect">Preference</label>
                    <select class="form-select" id="autoSizingSelect">
                        <option selected>Choose...</option>
                        <option value="CPP">CPP</option>
                        <option value="Java">Java</option>
                        <option value="Python">Python</option>
                    </select>
                </div>
                <div>
                    <button type="button" class="btn btn-success">Coding Master</button>
                    <button type="button" id="run" class="btn btn-success"><i class="bi bi-play-fill"></i></button>
                </div>
            </div>
            <textarea type="text" id="editor" class="form-control" placeholder="Enter your code here..."
                aria-label="Code editor"></textarea>
        </div>
        <div class="col d-flex flex-column rounded bg-dark px-4">
            <div class="h-50">
                <label for="input" class="text-light mt-4 mb-2">Input</label>
                <textarea type="text" class="form-control h-75" id="input" aria-label="Input area"></textarea>
            </div>
            <div class="h-50">
                <label for="output" class="text-light mb-2">Output</label>
                <textarea type="text" class="form-control h-75" id="output" aria-label="Output area"></textarea>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
    let editor = CodeMirror.fromTextArea(document.getElementById('editor'), {
        mode: "text/x-c++src",
        theme: "dracula",
        lineNumbers: true,
        autoCloseBrackets: true
    });

    let options = document.getElementById('autoSizingSelect');
    let input = document.getElementById('input');
    let output = document.getElementById('output');
    let run = document.getElementById('run');

    editor.setSize(0.7 * window.innerWidth, 0.87 * window.innerHeight);

    options.addEventListener('change', () => {
        if (options.value === 'Java') {
            editor.setOption("mode", "text/x-java");
        } else if (options.value === 'Python') {
            editor.setOption("mode", "text/x-python");
        } else if (options.value === 'CPP') {
            editor.setOption("mode", "text/x-c++src");
        }
    });

    run.addEventListener('click', async (event) => {
        console.log("Button clicked");
        event.preventDefault(); 

        let code = {
            code: editor.getValue(),
            lang: options.value,
            input: input.value
        };

        try {
            let response = await fetch('http://localhost:8000/compile', {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(code)
            });

            if (!response.ok) {
                throw new Error('Network response was not ok.');
            }

            let data = await response.json();
            output.value = data.output ? data.output.trim() : "Error: No output received.";
        } catch (error) {
            console.error('Error:', error);
            output.value = "Error: Failed to connect to server.";
        }
    });
});
    </script>
</body>

</html>
